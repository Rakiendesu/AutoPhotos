/*!
 * Flickr's Justified Gallery [fjGallery] v2.1.2 (https://flickr-justified-gallery.nkdev.info)
 * Copyright 2022 nK <https://nkdev.info>
 * Licensed under MIT (https://github.com/nk-o/flickr-justified-gallery/blob/master/LICENSE)
 */
function t(t,e,i){var o=(i||{}).atBegin;return function(t,e,i){var o,n=i||{},a=n.noTrailing,s=void 0!==a&&a,r=n.noLeading,h=void 0!==r&&r,c=n.debounceMode,l=void 0===c?void 0:c,g=!1,d=0;function u(){o&&clearTimeout(o)}function p(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];var r=this,c=Date.now()-d;function p(){d=Date.now(),e.apply(r,n)}function f(){o=void 0}g||(h||!l||o||p(),u(),void 0===l&&c>t?h?(d=Date.now(),s||(o=setTimeout(l?f:p,t))):p():!0!==s&&(o=setTimeout(l?f:p,void 0===l?t-c:t)))}return p.cancel=function(t){var e=(t||{}).upcomingOnly,i=void 0!==e&&e;u(),g=!i},p}(t,e,{debounceMode:!1!==(void 0!==o&&o)})}var e=function(t){var e=[],i=null,o=function(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];e=n,i||(i=requestAnimationFrame((function(){i=null,t.apply(void 0,e)})))};return o.cancel=function(){i&&(cancelAnimationFrame(i),i=null)},o},i={exports:{}};(i.exports=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight,this.widowLayoutStyle=t.widowLayoutStyle,this.isBreakoutRow=t.isBreakoutRow,this.items=[],this.height=0}).prototype={addItem:function(t){var e,i,o,n=this.items.concat(t),a=this.width-(n.length-1)*this.spacing,s=n.reduce((function(t,e){return t+e.aspectRatio}),0),r=a/this.targetRowHeight;return this.isBreakoutRow&&0===this.items.length&&t.aspectRatio>=1?(this.items.push(t),this.completeLayout(a/t.aspectRatio,"justify"),!0):s<this.minAspectRatio?(this.items.push(Object.assign({},t)),!0):s>this.maxAspectRatio?0===this.items.length?(this.items.push(Object.assign({},t)),this.completeLayout(a/s,"justify"),!0):(e=this.width-(this.items.length-1)*this.spacing,i=this.items.reduce((function(t,e){return t+e.aspectRatio}),0),o=e/this.targetRowHeight,Math.abs(s-r)>Math.abs(i-o)?(this.completeLayout(e/i,"justify"),!1):(this.items.push(Object.assign({},t)),this.completeLayout(a/s,"justify"),!0)):(this.items.push(Object.assign({},t)),this.completeLayout(a/s,"justify"),!0)},isLayoutComplete:function(){return this.height>0},completeLayout:function(t,e){var i,o,n,a,s,r=this.left,h=this.width-(this.items.length-1)*this.spacing;(void 0===e||["justify","center","left"].indexOf(e)<0)&&(e="left"),t!==(o=Math.max(this.edgeCaseMinRowHeight,Math.min(t,this.edgeCaseMaxRowHeight)))?(this.height=o,i=h/o/(h/t)):(this.height=t,i=1),this.items.forEach((function(t){t.top=this.top,t.width=t.aspectRatio*this.height*i,t.height=this.height,t.left=r,r+=t.width+this.spacing}),this),"justify"===e?(r-=this.spacing+this.left,n=(r-this.width)/this.items.length,a=this.items.map((function(t,e){return Math.round((e+1)*n)})),1===this.items.length?this.items[0].width-=Math.round(n):this.items.forEach((function(t,e){e>0?(t.left-=a[e-1],t.width-=a[e]-a[e-1]):t.width-=a[e]}))):"center"===e&&(s=(this.width-r)/2,this.items.forEach((function(t){t.left+=s+this.spacing}),this))},forceComplete:function(t,e){"number"==typeof e?this.completeLayout(e,this.widowLayoutStyle):this.completeLayout(this.targetRowHeight,this.widowLayoutStyle)},getItems:function(){return this.items}};
/*!
 * Copyright 2019 SmugMug, Inc.
 * Licensed under the terms of the MIT license. Please see LICENSE file in the project root for terms.
 * @license
 */
var o=i.exports;function n(t,e){var i;return!1!==t.fullWidthBreakoutRowCadence&&(e._rows.length+1)%t.fullWidthBreakoutRowCadence==0&&(i=!0),new o({top:e._containerHeight,left:t.containerPadding.left,width:t.containerWidth-t.containerPadding.left-t.containerPadding.right,spacing:t.boxSpacing.horizontal,targetRowHeight:t.targetRowHeight,targetRowHeightTolerance:t.targetRowHeightTolerance,edgeCaseMinRowHeight:.5*t.targetRowHeight,edgeCaseMaxRowHeight:2*t.targetRowHeight,rightToLeft:!1,isBreakoutRow:i,widowLayoutStyle:t.widowLayoutStyle})}function a(t,e,i){return e._rows.push(i),e._layoutItems=e._layoutItems.concat(i.getItems()),e._containerHeight+=i.height+t.boxSpacing.vertical,i.items}var s=function(t,e){var i={},o={},s={containerWidth:1060,containerPadding:10,boxSpacing:10,targetRowHeight:320,targetRowHeightTolerance:.25,maxNumRows:Number.POSITIVE_INFINITY,forceAspectRatio:!1,showWidows:!0,fullWidthBreakoutRowCadence:!1,widowLayoutStyle:"left"},r={},h={};return e=e||{},i=Object.assign(s,e),r.top=isNaN(parseFloat(i.containerPadding.top))?i.containerPadding:i.containerPadding.top,r.right=isNaN(parseFloat(i.containerPadding.right))?i.containerPadding:i.containerPadding.right,r.bottom=isNaN(parseFloat(i.containerPadding.bottom))?i.containerPadding:i.containerPadding.bottom,r.left=isNaN(parseFloat(i.containerPadding.left))?i.containerPadding:i.containerPadding.left,h.horizontal=isNaN(parseFloat(i.boxSpacing.horizontal))?i.boxSpacing:i.boxSpacing.horizontal,h.vertical=isNaN(parseFloat(i.boxSpacing.vertical))?i.boxSpacing:i.boxSpacing.vertical,i.containerPadding=r,i.boxSpacing=h,o._layoutItems=[],o._awakeItems=[],o._inViewportItems=[],o._leadingOrphans=[],o._trailingOrphans=[],o._containerHeight=i.containerPadding.top,o._rows=[],o._orphans=[],i._widowCount=0,function(t,e,i){var o,s,r,h=[];return t.forceAspectRatio&&i.forEach((function(e){e.forcedAspectRatio=!0,e.aspectRatio=t.forceAspectRatio})),i.some((function(i,r){if(isNaN(i.aspectRatio))throw new Error("Item "+r+" has an invalid aspect ratio");if(s||(s=n(t,e)),o=s.addItem(i),s.isLayoutComplete()){if(h=h.concat(a(t,e,s)),e._rows.length>=t.maxNumRows)return s=null,!0;if(s=n(t,e),!o&&(o=s.addItem(i),s.isLayoutComplete())){if(h=h.concat(a(t,e,s)),e._rows.length>=t.maxNumRows)return s=null,!0;s=n(t,e)}}})),s&&s.getItems().length&&t.showWidows&&(e._rows.length?(r=e._rows[e._rows.length-1].isBreakoutRow?e._rows[e._rows.length-1].targetRowHeight:e._rows[e._rows.length-1].height,s.forceComplete(!1,r)):s.forceComplete(!1),h=h.concat(a(t,e,s)),t._widowCount=s.getItems().length),e._containerHeight=e._containerHeight-t.boxSpacing.vertical,e._containerHeight=e._containerHeight+t.containerPadding.bottom,{containerHeight:e._containerHeight,widowCount:t._widowCount,boxes:e._layoutItems}}(i,o,t.map((function(t){return t.width&&t.height?{aspectRatio:t.width/t.height}:{aspectRatio:t}})))};let r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var h=r;function c(t,e){let i,o=!1,n=!1;const a=()=>{o?e(o):t.naturalWidth&&(o={width:t.naturalWidth,height:t.naturalHeight},e(o),clearInterval(i),n&&c())},s=()=>{a()},r=()=>{a()},h=()=>{0<t.naturalWidth&&a()},c=()=>{n=!1,t.removeEventListener("load",s),t.removeEventListener("error",r)};h(),o||(n=!0,t.addEventListener("load",s),t.addEventListener("error",r),i=setInterval(h,100))}const l=[],g=e((()=>{l.forEach((t=>{t.resize()}))}));var d;h.addEventListener("resize",g),h.addEventListener("orientationchange",g),h.addEventListener("load",g),d=()=>{g()},"complete"===document.readyState||"interactive"===document.readyState?d():document.addEventListener("DOMContentLoaded",d,{capture:!0,once:!0,passive:!0});let u=0;class p{constructor(i,o){const n=this;n.instanceID=u,u+=1,n.$container=i,n.images=[],n.defaults={itemSelector:".fj-gallery-item",imageSelector:"img",gutter:10,rowHeight:320,rowHeightTolerance:.25,maxRowsCount:Number.POSITIVE_INFINITY,lastRow:"left",transitionDuration:"0.3s",calculateItemsHeight:!1,resizeDebounce:100,isRtl:"rtl"===n.css(n.$container,"direction"),onInit:null,onDestroy:null,onAppendImages:null,onBeforeJustify:null,onJustify:null};const a=n.$container.dataset||{},s={};Object.keys(a).forEach((t=>{const e=t.substr(0,1).toLowerCase()+t.substr(1);e&&void 0!==n.defaults[e]&&(s[e]=a[t])})),n.options={...n.defaults,...s,...o},n.pureOptions={...n.options},n.resize=t(n.options.resizeDebounce,n.resize),n.justify=e(n.justify.bind(n)),n.init()}css(t,e){return"string"==typeof e?h.getComputedStyle(t).getPropertyValue(e):(Object.keys(e).forEach((i=>{t.style[i]=e[i]})),t)}applyTransition(t,e){const i=this;i.onTransitionEnd(t)(),i.css(t,{"transition-property":e.join(", "),"transition-duration":i.options.transitionDuration}),t.addEventListener("transitionend",i.onTransitionEnd(t,e),!1)}onTransitionEnd(t){const e=this;return()=>{e.css(t,{"transition-property":"","transition-duration":""}),t.removeEventListener("transitionend",e.onTransitionEnd(t))}}addToFjGalleryList(){l.push(this),g()}removeFromFjGalleryList(){const t=this;l.forEach(((e,i)=>{e.instanceID===t.instanceID&&l.splice(i,1)}))}init(){const t=this;t.appendImages(t.$container.querySelectorAll(t.options.itemSelector)),t.addToFjGalleryList(),t.options.onInit&&t.options.onInit.call(t)}appendImages(t){const e=this;h.jQuery&&t instanceof h.jQuery&&(t=t.get()),t&&t.length&&(t.forEach((t=>{if(t&&!t.fjGalleryImage&&t.querySelector){const i=t.querySelector(e.options.imageSelector);if(i){t.fjGalleryImage=e;const o={$item:t,$image:i,width:parseFloat(i.getAttribute("width"))||!1,height:parseFloat(i.getAttribute("height"))||!1,loadSizes(){const t=this;c(i,(i=>{t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height,e.resize())}))}};o.loadSizes(),e.images.push(o)}}})),e.options.onAppendImages&&e.options.onAppendImages.call(e,[t]),e.justify())}justify(){const t=this,e=[];t.justifyCount=(t.justifyCount||0)+1,t.options.onBeforeJustify&&t.options.onBeforeJustify.call(t),t.images.forEach((t=>{t.width&&t.height&&e.push(t.width/t.height)}));const i={containerWidth:t.$container.getBoundingClientRect().width,containerPadding:{top:parseFloat(t.css(t.$container,"padding-top"))||0,right:parseFloat(t.css(t.$container,"padding-right"))||0,bottom:parseFloat(t.css(t.$container,"padding-bottom"))||0,left:parseFloat(t.css(t.$container,"padding-left"))||0},boxSpacing:t.options.gutter,targetRowHeight:t.options.rowHeight,targetRowHeightTolerance:t.options.rowHeightTolerance,maxNumRows:t.options.maxRowsCount,showWidows:"hide"!==t.options.lastRow},o=s(e,i);if(o.widowCount&&("center"===t.options.lastRow||"right"===t.options.lastRow)){const e=o.boxes[o.boxes.length-1];let n=i.containerWidth-e.width-e.left;"center"===t.options.lastRow&&(n/=2),"right"===t.options.lastRow&&(n-=i.containerPadding.right);for(let t=1;t<=o.widowCount;t+=1)o.boxes[o.boxes.length-t].left=o.boxes[o.boxes.length-t].left+n}t.options.isRtl&&o.boxes.forEach(((t,e)=>{o.boxes[e].left=i.containerWidth-o.boxes[e].left-o.boxes[e].width-i.containerPadding.right+i.containerPadding.left}));let n=0,a=0;const r={};t.images.forEach(((e,i)=>{if(o.boxes[n]&&e.width&&e.height){if(t.options.calculateItemsHeight&&void 0===r[o.boxes[n].top]&&Object.keys(r).length&&(a+=r[Object.keys(r).pop()]-o.boxes[i-1].height),t.options.transitionDuration&&1<t.justifyCount&&t.applyTransition(e.$item,["transform"]),t.css(e.$item,{display:"",position:"absolute",transform:`translateX(${o.boxes[n].left}px) translateY(${o.boxes[n].top+a}px) translateZ(0)`,width:`${o.boxes[n].width}px`}),t.options.calculateItemsHeight){const t=e.$item.getBoundingClientRect();(void 0===r[o.boxes[n].top]||r[o.boxes[n].top]<t.height)&&(r[o.boxes[n].top]=t.height)}n+=1}else t.css(e.$item,{display:"none"})})),t.options.calculateItemsHeight&&Object.keys(r).length&&(a+=r[Object.keys(r).pop()]-o.boxes[o.boxes.length-1].height),t.options.transitionDuration&&t.applyTransition(t.$container,["height"]),t.css(t.$container,{height:`${o.containerHeight+a}px`}),t.options.onJustify&&t.options.onJustify.call(t)}updateOptions(t){const e=this;e.options={...e.options,...t},e.justify()}destroy(){const t=this;t.removeFromFjGalleryList(),t.justifyCount=0,t.options.onDestroy&&t.options.onDestroy.call(t),t.css(t.$container,{height:"",transition:""}),t.images.forEach((e=>{t.css(e.$item,{position:"",transform:"",transition:"",width:"",height:""})})),t.images.forEach((t=>{delete t.$item.fjGalleryImage})),delete t.$container.fjGallery}resize(){this.justify()}}const f=function(t,e,...i){("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)&&(t=[t]);const o=t.length;let n,a=0;for(;a<o;a+=1)if("object"==typeof e||void 0===e?t[a].fjGallery||(t[a].fjGallery=new p(t[a],e)):t[a].fjGallery&&(n=t[a].fjGallery[e].apply(t[a].fjGallery,i)),void 0!==n)return n;return t};f.constructor=p;export{f as default};
//# sourceMappingURL=fjGallery.esm.min.js.map
